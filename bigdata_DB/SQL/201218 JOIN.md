## JOIN

> |             | Oracle |    ANSI    |
> | :---------: | :----: | :--------: |
> | 테이블 구분 |  ','   |    JOIN    |
> |  조인 조건  | WHERE  | ON / USING |



```sql
--Oracle
SELECT *
FROM EMP E, DEPT D 
WHERE E.DEPTNO = D.DEPTNO ; 

SELECT *
FROM EMPLOYEES E,DEPARTMENTS D,LOCATIONS L,COUNTRIES C
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND D.LOCATION_ID = L.LOCATION_ID
AND L.COUNTRY_ID = C.COUNTRY_ID ;

SELECT C.CUST_ID,SUM(ORDER_TOTAL),C.CUST_LNAME
FROM TEST.CUSTOMERS C, TEST.ORDERS O
WHERE C.CUST_ID = O.CUST_ID
GROUP BY C.CUST_ID,C.CUST_LNAME;

----------------------------------------------

--ANSI
SELECT *
FROM EMP E JOIN DEPT D 
ON E.DEPTNO = D.DEPTNO ; 

--3개 이상 테이블 조인 시, ON을 따로따로 작성
SELECT *
FROM EMPLOYEES E JOIN DEPARTMENTS D 
ON E.DEPARTMENT_ID = D.DEPARTMENT_ID
JOIN LOCATIONS L
ON D.LOCATION_ID = L.LOCATION_ID
JOIN COUNTRIES C
ON L.COUNTRY_ID = C.COUNTRY_ID ;

SELECT *
FROM EMPLOYEES E JOIN DEPARTMENTS D
USING (DEPARTMENT_ID,MANAGER_ID) ;

--USING에 사용된 column은 SELECT에서 사용 시, table명을 붙이지 않음
SELECT E.EMPLOYEE_ID, E.LAST_NAME, DEPARTMENT_ID, D.DEPARTMENT_NAME
FROM EMPLOYEES E JOIN DEPARTMENTS D
USING (DEPARTMENT_ID) ;

--ON :  JOIN조건 / WHERE : 일반 조건
--ON에 JOIN조건과 일반 조건을 함께 쓸 수 있음
SELECT *
FROM EMP E JOIN DEPT D
ON E.DEPTNO = D.DEPTNO
WHERE E.SAL > 2000;

SELECT *
FROM EMP E JOIN DEPT D
ON E.DEPTNO = D.DEPTNO
AND E.SAL > 2000;

SELECT C.CUST_ID,SUM(ORDER_TOTAL),C.CUST_LNAME
FROM TEST.CUSTOMERS C JOIN TEST.ORDERS O
ON C.CUST_ID = O.CUST_ID
GROUP BY C.CUST_ID,C.CUST_LNAME;
```



### Self JOIN

```sql
--ANSI
SELECT E.*
FROM EMP E JOIN EMP M
ON M.ENAME = 'JONES'
AND E.SAL > M.SAL ;

SELECT E.ENAME,M.MGR,M.ENAME
FROM EMP E JOIN EMP M
ON E.EMPNO = M.MGR;

--Oracle
SELECT E.*
FROM EMP E, EMP M
WHERE M.ENAME = 'JONES'
AND E.SAL > M.SAL;

SELECT E.ENAME,M.MGR,M.ENAME
FROM EMP E,EMP M
WHERE E.EMPNO = M.MGR;
```



### Outer JOIN

```SQL
--ANSI
--LEFT OUTER JOIN : 두 테이블에서 범위가 큰 쪽(출력하고자 하는)이 오른쪽일 때
SELECT *
FROM EMP E RIGHT OUTER JOIN DEPT D
ON E.DEPTNO = D.DEPTNO;


--LEFT OUTER JOIN : 두 테이블에서 범위가 큰 쪽(출력하고자 하는)이 왼쪽일 때
SELECT *
FROM DEPT D LEFT OUTER JOIN EMP E
ON E.DEPTNO = D.DEPTNO;

--FULL OUTER JOIN
SELECT E.EMPLOYEE_ID
    ,E.LAST_NAME
    ,E.DEPARTMENT_ID
    ,D.DEPARTMENT_ID
    ,D.DEPARTMENT_NAME
FROM EMPLOYEES E FULL OUTER JOIN DEPARTMENTS D
ON E.DEPARTMENT_ID = D.DEPARTMENT_ID;

----------------------------------------------

--INNER JOIN vs OUTER JOIN
--고객별 주문 금액 합계
SELECT C.CUST_ID,SUM(ORDER_TOTAL),C.CUST_LNAME
FROM TEST.CUSTOMERS C JOIN TEST.ORDERS O
ON C.CUST_ID = O.CUST_ID
GROUP BY C.CUST_ID,C.CUST_LNAME;

--구매 이력이 없는 고객까지 합친, 고객별 주문 금액 합계
SELECT C.CUST_ID,SUM(ORDER_TOTAL),C.CUST_LNAME
FROM TEST.CUSTOMERS C LEFT OUTER JOIN TEST.ORDERS O
ON C.CUST_ID = O.CUST_ID
GROUP BY C.CUST_ID,C.CUST_LNAME; 

------------------------------------------
------------------------------------------
--Oracle
--데이터가 부족한 table에 (+) 추가
--출력하고자 하는 table은 그대로 두고
SELECT E.EMPLOYEE_ID
    ,E.LAST_NAME
    ,E.DEPARTMENT_ID
    ,D.DEPARTMENT_ID
    ,D.DEPARTMENT_NAME
FROM EMPLOYEES E, DEPARTMENTS D
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID(+);
```

